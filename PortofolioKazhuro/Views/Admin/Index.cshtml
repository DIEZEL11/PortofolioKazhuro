@using PortofolioKazhuro.ViewModel
@model AdminViewModel

@{
    ViewData["Title"] = "Админская панель";
    Layout = "_Layout";
}

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        @TempData["Error"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Закрыть"></button>
    </div>
}

@if (TempData["Success"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="bi bi-check-circle-fill me-2"></i>
        @TempData["Success"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Закрыть"></button>
    </div>
}

<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 fw-bold text-primary">
            <i class="fas fa-tools me-2"></i>@ViewData["Title"]
        </h1>
        <a asp-controller="Home" asp-action="Index" class="btn btn-outline-primary shadow-sm">
            <i class="fas fa-home me-1"></i>Публичная страница
        </a>
    </div>

    <!-- PROFILE -->
    <div class="card mb-5 shadow-lg border-0 rounded-4">
        <div class="card-header bg-gradient bg-primary text-white rounded-top-4">
            <h5 class="mb-0">
                <i class="fas fa-user me-2"></i>Профиль пользователя
            </h5>
        </div>
        <div class="card-body">
            <form asp-action="UpdateProfile" method="post" enctype="multipart/form-data" novalidate>
                @Html.AntiForgeryToken()
                <input type="hidden" asp-for="Profile.Id" />

                <div class="row g-4 align-items-stretch">
                    <!-- Фото -->
                    <div class="col-12 col-md-4 d-flex flex-column align-items-center justify-content-start">
                        @if (Model.Profile.PhotoData != null)
                        {
                            var base64 = Convert.ToBase64String(Model.Profile.PhotoData);
                            var imgSrc = $"data:{Model.Profile.PhotoMimeType};base64,{base64}";
                            <img src="@imgSrc"
                                 class="rounded-circle border border-3 border-primary shadow mb-3"
                                 style="width:180px; height:180px; object-fit:cover; background:#f8f9fa;"
                                 alt="Фото профиля" />
                        }
                        else
                        {
                            <div class="rounded-circle border border-3 border-secondary d-flex align-items-center justify-content-center mb-3"
                                 style="width:180px; height:180px; background:#f8f9fa;">
                                <span class="text-muted fs-5">Нет фото</span>
                            </div>
                        }

                        <label asp-for="PhotoFile" class="btn btn-outline-secondary w-75 shadow-sm">
                            <i class="fas fa-upload me-1"></i> Загрузить фото
                            <input asp-for="PhotoFile" type="file" accept="image/*" class="d-none" />
                        </label>
                    </div>

                    <!-- Данные профиля -->
                    <div class="col-12 col-md-8">
                        <div class="row g-3">
                            <!-- Имя -->
                            <div class="col-12 col-md-4 form-floating">
                                <input asp-for="Profile.Name" class="form-control" placeholder="Имя" />
                                <label asp-for="Profile.Name">Имя</label>
                            </div>

                            <!-- Фамилия -->
                            <div class="col-12 col-md-4 form-floating">
                                <input asp-for="Profile.Surname" class="form-control" placeholder="Фамилия" />
                                <label asp-for="Profile.Surname">Фамилия</label>
                            </div>

                            <!-- Отчество -->
                            <div class="col-12 col-md-4 form-floating">
                                <input asp-for="Profile.Patronymic" class="form-control" placeholder="Отчество" />
                                <label asp-for="Profile.Patronymic">Отчество</label>
                            </div>

                            <!-- Дата рождения -->
                            <div class="col-12 col-md-4">
                                <label asp-for="Profile.Birthday" class="form-label fw-semibold">
                                    <i class="fas fa-calendar-alt me-2 text-primary"></i>Дата рождения
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text bg-light border-end-0">
                                        <i class="fas fa-calendar"></i>
                                    </span>
                                    <input asp-for="Profile.Birthday"
                                           type="date"
                                           class="form-control border-start-0"
                                           min="1900-01-01"
                                           max="@DateTime.UtcNow.ToString("yyyy-MM-dd")"
                                           value="@Model.Profile.Birthday.ToString("yyyy-MM-dd")" />
                                </div>
                                <span asp-validation-for="Profile.Birthday" class="text-danger small"></span>
                            </div>

                            <!-- Email -->
                            <div class="col-12 col-md-6">
                                <label asp-for="Profile.Email" class="form-label fw-semibold">
                                    <i class="fas fa-envelope me-2 text-secondary"></i>Email
                                </label>
                                <input asp-for="Profile.Email" class="form-control" placeholder="Email" />
                                <span asp-validation-for="Profile.Email" class="text-danger small"></span>
                            </div>

                            <!-- Телефон -->
                            <div class="col-12 col-md-6">
                                <label asp-for="Profile.PhoneNumber" class="form-label fw-semibold">
                                    <i class="fas fa-phone me-2 text-secondary"></i>Телефон
                                </label>
                                <input asp-for="Profile.PhoneNumber" class="form-control" placeholder="Телефон" />
                                <span asp-validation-for="Profile.PhoneNumber" class="text-danger small"></span>
                            </div>

                            <!-- Соцсети -->
                            <div class="col-12">
                                <div class="row g-2">
                                    <div class="col-6 col-md-3">
                                        <div class="input-group has-validation">
                                            <span class="input-group-text"><i class="fab fa-github"></i></span>
                                            <input asp-for="Profile.GitHubUrl" class="form-control" placeholder="GitHub" />
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-3">
                                        <div class="input-group has-validation">
                                            <span class="input-group-text"><i class="fas fa-code"></i></span>
                                            <input asp-for="Profile.LeetCodeUrl" class="form-control" placeholder="LeetCode" />
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-3">
                                        <div class="input-group has-validation">
                                            <span class="input-group-text"><i class="fab fa-linkedin"></i></span>
                                            <input asp-for="Profile.LinkedinUrl" class="form-control" placeholder="LinkedIn" />
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-3">
                                        <div class="input-group has-validation">
                                            <span class="input-group-text"><i class="fab fa-telegram"></i></span>
                                            <input asp-for="Profile.TelegramUrl" class="form-control" placeholder="Telegram" />
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- О себе -->
                            <div class="col-12 form-floating">
                                <textarea asp-for="Profile.About"
                                          class="form-control"
                                          placeholder="О себе"
                                          style="min-height: 90px;"></textarea>
                                <label asp-for="Profile.About">О себе</label>
                            </div>

                            <!-- Кнопка -->
                            <div class="col-12 text-end mt-3">
                                <button type="submit"
                                        class="btn btn-lg btn-success shadow"
                                        data-bs-toggle="tooltip"
                                        title="Сохранить изменения профиля">
                                    <i class="fas fa-save me-2"></i>Сохранить профиль
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- EDUCATION -->
    @await Html.PartialAsync("_Education", Model.educations)

    <!-- SKILLS -->
    @await Html.PartialAsync("_Skills", Model.Skills)

    <!-- PROJECTS -->
    @await Html.PartialAsync("_Projects", Model.Projects)

    <!-- CERTIFICATES -->
    @await Html.PartialAsync("_CertificatesPartial", Model.Certificates)

    <!-- VISITOR STATS -->
    @await Html.PartialAsync("_VisitorStats", Model.visitorStats)

    <!-- LOGS -->
    @await Html.PartialAsync("_Logs", Model.Logs)
</div>
